# 库存管理系统 - 新功能使用说明

## 🆕 新增功能概述

本次更新为库存管理系统添加了以下重要功能：

### 1. 商品管理增强功能
- ✅ **编辑商品**：直接在表格中编辑商品信息
- ✅ **新增商品**：快速添加新商品和库存
- ✅ **删除商品**：安全删除不需要的商品
- ✅ **权限控制**：基于用户角色的操作权限
- ✅ **增强界面**：多个位置的CRUD操作按钮
- ✅ **操作提示**：清晰的功能说明和引导

### 2. 外部客户查看页面
- ✅ **商品目录**：专为外部客户设计的商品展示页面
- ✅ **双视图模式**：表格视图和网格视图
- ✅ **搜索过滤**：按商品名称、分类搜索
- ✅ **实时库存**：显示当前可用库存数量

## 🚀 快速开始

### 使用测试脚本启动
```powershell
# PowerShell版本
.\test-new-features.ps1

# 批处理版本
test-new-features.bat
```

### 手动启动
```bash
# 1. 启动数据库
docker-compose up db -d

# 2. 设置环境变量
$env:DATABASE_URL="postgresql://user:password@localhost:15432/inventory_db"

# 3. 同步数据库
npx prisma db push

# 4. 添加测试数据
npm run db:seed-test

# 5. 启动应用
npm run dev
```

## 📋 功能详细说明

### 商品管理功能

#### 🔍 CRUD按钮位置
库存管理界面现在有**多个位置**可以进行CRUD操作：

1. **页面顶部**：标题右侧的"新增商品"按钮
2. **搜索栏右侧**：
   - 绿色"新增商品"按钮
   - 蓝色"批量编辑"按钮
   - 红色"批量删除"按钮
3. **表格操作列**：每行商品的编辑/删除图标
4. **操作提示框**：蓝色提示框说明如何使用功能

#### 1. 编辑商品
- **位置**：
  - 表格操作列 → 蓝色编辑图标 ✏️
  - 搜索栏右侧 → "批量编辑"按钮（待实现）
- **权限**：管理员(ADMIN)、经理(MANAGER)、测试用户
- **功能**：
  - 修改商品名称、描述、SKU
  - 调整库存数量、预留数量
  - 更新存储位置、批次号
  - 设置销售价格、低库存阈值

#### 2. 新增商品
- **位置**：
  - 页面顶部右侧 → "新增商品"按钮
  - 搜索栏右侧 → 绿色"新增商品"按钮
- **权限**：管理员(ADMIN)、经理(MANAGER)、测试用户
- **功能**：
  - 创建全新商品
  - 设置初始库存
  - 配置商品属性
  - 自动生成库存记录

#### 3. 删除商品
- **位置**：
  - 表格操作列 → 红色删除图标 🗑️
  - 搜索栏右侧 → "批量删除"按钮（待实现）
- **权限**：管理员(ADMIN)、经理(MANAGER)、测试用户
- **功能**：
  - 安全删除确认
  - 删除库存记录
  - 保留商品信息（可选）

### 外部客户查看页面

#### 访问方式
1. **从主页**：点击"商品目录"卡片
2. **直接访问**：http://localhost:3000/catalog
3. **新标签页**：自动在新标签页打开

#### 页面特色
- **专业外观**：类似图片中的日式商品目录风格
- **公司品牌**：大一株式会社标识和联系方式
- **双视图模式**：
  - 表格视图：详细的商品信息表格
  - 网格视图：卡片式商品展示

#### 表格视图字段
| 字段 | 说明 |
|------|------|
| No. | 序号 |
| 分类 | 商品分类标签 |
| 图像 | 商品图片（60x60像素） |
| 商品名 | 商品名称和描述 |
| JANコード | SKU编码 |
| 销量 | 销售数量（待实现） |
| 箱规 | 包装规格（待实现） |
| 在库数 | 当前可用库存 |
| 定价 | 销售价格 |

## 🎯 测试指南

### 权限测试

#### 测试模式（经理权限）
- **访问方式**：主页 → "测试模式（无需登录）"
- **权限范围**：完整的库存管理权限，可以增删改查
- **测试要点**：
  - 查看库存表格
  - 使用搜索和过滤功能
  - 测试所有CRUD操作
  - 访问外部商品目录

#### 管理员测试
- **登录信息**：admin / admin
- **权限范围**：完整的系统管理权限
- **测试要点**：
  - 所有库存管理功能
  - 系统设置功能
  - 用户管理功能

#### 经理测试
- **登录信息**：manager / manager
- **权限范围**：库存管理权限（无系统设置）
- **测试要点**：
  - 库存增删改查
  - 商品信息编辑
  - 权限边界测试

#### 普通用户测试
- **登录信息**：user1 / user1
- **权限范围**：只能查看，无法编辑
- **测试要点**：
  - 查看库存信息
  - 无CRUD按钮显示
  - 权限限制验证

### 功能测试流程

#### 1. 新增商品测试
1. 登录管理员、经理账户或使用测试模式
2. 进入库存管理页面
3. 点击以下任一按钮：
   - 页面顶部"新增商品"
   - 搜索栏右侧绿色"新增商品"
4. 填写商品信息：
   - 商品名称：测试商品
   - SKU：TEST001
   - 描述：这是一个测试商品
   - 库存数量：100
   - 销售价格：99.99
   - 低库存阈值：10
5. 点击"保存"
6. 验证商品出现在列表中

#### 2. 编辑商品测试
1. 在库存表格中找到要编辑的商品
2. 点击操作列的蓝色编辑图标 ✏️
3. 修改商品信息（如价格、库存等）
4. 点击"保存"
5. 验证修改已生效

#### 3. 删除商品测试
1. 在库存表格中找到要删除的商品
2. 点击操作列的红色删除图标 🗑️
3. 确认删除操作
4. 验证商品已从列表中移除

#### 4. 外部目录测试
1. 从主页点击"商品目录"
2. 验证页面在新标签页打开
3. 测试表格视图和网格视图切换
4. 测试搜索和分类过滤功能
5. 验证商品信息显示正确

## 🔧 技术实现

### 前端组件
- **InventoryTable.tsx**：增强的库存管理表格
- **CatalogPage.tsx**：外部客户查看页面
- **Material-UI**：对话框、表单、图标等UI组件

### 后端API
- **POST /api/inventory**：新增商品和库存
- **PUT /api/inventory/[id]**：编辑商品信息
- **DELETE /api/inventory/[id]**：删除商品
- **GET /api/catalog**：公开的商品目录API

### 权限控制
- **认证中间件**：验证用户身份
- **角色权限**：基于用户角色控制操作权限
- **前端权限**：根据用户角色显示/隐藏功能
- **测试用户**：特殊处理，给予经理权限

## 🎨 界面特色

### 商品管理界面
- **现代化设计**：Material Design风格
- **响应式布局**：适配各种屏幕尺寸
- **交互友好**：悬停效果、加载状态
- **权限提示**：清晰的权限标识
- **多位置操作**：顶部、搜索栏、表格中都有操作按钮
- **操作引导**：蓝色提示框指导用户使用

### 外部客户界面
- **专业外观**：企业级商品目录设计
- **品牌标识**：大一株式会社Logo和联系方式
- **双视图模式**：满足不同查看需求
- **搜索过滤**：快速找到目标商品

## 🚨 注意事项

### 数据安全
- 删除操作不可撤销，请谨慎操作
- 建议定期备份数据库
- 测试环境与生产环境分离

### 权限管理
- 普通用户无法进行增删改操作
- 管理员拥有最高权限
- 经理可管理库存但无系统设置权限
- 测试用户自动获得经理权限

### 性能优化
- 大量数据时建议使用分页
- 图片上传功能待实现
- 搜索功能支持模糊匹配

## 📞 技术支持

如遇到问题，请检查：
1. Docker是否正常运行
2. 数据库连接是否正常
3. 环境变量是否正确设置
4. 端口是否被占用
5. 用户权限是否正确

### 常见问题
**Q: 看不到CRUD按钮？**
A: 请确认：
- 已登录或使用测试模式
- 用户角色为MANAGER或ADMIN
- 测试用户自动获得经理权限

**Q: 按钮位置在哪里？**
A: CRUD按钮位于多个位置：
- 页面顶部右侧
- 搜索栏右侧
- 表格操作列
- 查看蓝色提示框说明

运行测试脚本：`.\test-new-features.ps1` 进行完整功能测试。 